--- Scripts for create STG tables ---

-- LENDX_STG.STG_BORROWER definition

create or replace TABLE LENDX_STG.STG_ORIGINATOR (
    DIMENSION_KEY VARCHAR(32) NOT NULL,
	CREATION_DATE TIMESTAMP_TZ(9),
	EMAIL_ADDRESS VARCHAR(256),  
	ENCODED_KEY VARCHAR(32) NOT NULL,
	ID VARCHAR(32),
	LAST_MODIFIED_DATE TIMESTAMP_TZ(9),
	NAME VARCHAR(32),
	NOTES VARCHAR(16777216),
	PHONE_NUMBER VARCHAR(256),
	STATE VARCHAR(256)
);

-- LENDX_STG.STG_BORROWER definition

create or replace TABLE LENDX_STG.STG_BORROWER (
	DIMENSION_KEY VARCHAR(32) NOT NULL,
	ACTIVATION_DATE TIMESTAMP_TZ(9),
	CITY VARCHAR(50),
	COUNTRY VARCHAR(50),
	STREET_ADDRESS_LINE1 VARCHAR(255),
	STREET_ADDRESS_LINE2 VARCHAR(255),
	POST_CODE VARCHAR(50),
	REGION VARCHAR(50),
	BIRTH_DATE VARCHAR(256),
	APPROVED_DATE TIMESTAMP_TZ(9),
	CLIENT_ROLE_KEY VARCHAR(32),
	CREATION_DATE TIMESTAMP_TZ(9),
	EMAIL_ADDRESS VARCHAR(256),
	ENCODED_KEY VARCHAR(256) NOT NULL,
	FIRST_NAME VARCHAR(256),
	GENDER VARCHAR(256),
	GROUP_LOAN_CYCLE NUMBER(38,0),
	ID VARCHAR(256),
	LAST_MODIFIED_DATE TIMESTAMP_TZ(9),
	LAST_NAME VARCHAR(256),
	NOTES	VARCHAR(16777216),
	MIDDLE_NAME VARCHAR(256),
	HOME_PHONE VARCHAR(256),
	MOBILE_PHONE VARCHAR(256),
	PREFERRED_LANGUAGE VARCHAR(32),
	STATE VARCHAR(32),
	CONSTRAINT PK_DIM_BORROWER PRIMARY KEY (DIMENSION_KEY)
);

-- LENDX_STG.STG_LOAN_PRODUCT definition

create or replace TABLE LENDX_STG.STG_LOAN_PRODUCT
(
    DIMENSION_KEY VARCHAR(32) NOT NULL,
    ACCOUNTING_METHOD VARCHAR(16777216),
    ACCOUNT_INITIAL_STATE VARCHAR(16777216),
    ACCOUNT_LINKING_ENABLED BOOLEAN,
    ACTIVATED BOOLEAN,
    ALLOW_ARBITRARY_FEES BOOLEAN,
    AMORTIZATION_METHOD VARCHAR(16777216),
    AUTO_CREATE_LINKED_ACCOUNTS BOOLEAN,
    AUTO_LINK_ACCOUNTS BOOLEAN,
    CREATION_DATE TIMESTAMP_TZ(9),
    DAYS_IN_YEAR VARCHAR(16777216),
    DEFAULT_LOAN_AMOUNT VARCHAR(16777216),
    DEFAULT_PRINCIPAL_REPAYMENT_INTERVAL NUMBER(38, 0),
    DEFAULT_REPAYMENT_PERIOD_COUNT NUMBER(38, 0),
    ENCODED_KEY VARCHAR(16777216),
    FOR_HYBRID_GROUPS BOOLEAN,
    FOR_INDIVIDUALS BOOLEAN,
    FOR_PURE_GROUPS BOOLEAN,
    FUTURE_PAYMENTS_ACCEPTANCE VARCHAR(16777216),
    GRACE_PERIOD_TYPE VARCHAR(16777216),
    ID VARCHAR(16777216) NOT NULL,
    ID_GENERATOR_TYPE VARCHAR(16777216),
    ID_PATTERN VARCHAR(16777216),
    INTEREST_ACCRUED_ACCOUNTING_METHOD VARCHAR(16777216),
    INTEREST_APPLICATION_METHOD VARCHAR(16777216),
    INTEREST_BALANCE_CALCULATION_METHOD VARCHAR(16777216),
    INTEREST_CALCULATION_METHOD VARCHAR(16777216),
    LAST_MODIFIED_DATE TIMESTAMP_TZ(9),
    LATE_PAYMENTS_RECALCULATION_METHOD VARCHAR(16777216),
    LINE_OF_CREDIT_REQUIREMENT VARCHAR(16777216),
    LOAN_FEES VARIANT,
    LOAN_PENALTY_CALCULATION_METHOD VARCHAR(16777216),
    LOAN_PRODUCT_RULES VARIANT,
    LOAN_PRODUCT_TYPE VARCHAR(16777216),
    MAX_NUMBER_OF_DISBURSEMENT_TRANCHES NUMBER(38, 0),
    PAYMENT_METHOD VARCHAR(16777216),
    PREPAYMENT_ACCEPTANCE VARCHAR(16777216),
    PRODUCT_DESCRIPTION VARCHAR(16777216),
    PRODUCT_NAME VARCHAR(16777216),
    REPAYMENT_ALLOCATION_ORDER VARIANT,
    REPAYMENT_CURRENCY_ROUNDING VARCHAR(16777216),
    REPAYMENT_ELEMENTS_ROUNDING_METHOD VARCHAR(16777216),
    REPAYMENT_PERIOD_UNIT VARCHAR(16777216),
    REPAYMENT_RESCHEDULING_METHOD VARCHAR(16777216),
    REPAYMENT_SCHEDULE_EDIT_OPTIONS VARIANT,
    REPAYMENT_SCHEDULE_METHOD VARCHAR(16777216),
    ROUNDING_REPAYMENT_SCHEDULE_METHOD VARCHAR(16777216),
    SCHEDULE_DUE_DATES_METHOD VARCHAR(16777216),
    SCHEDULE_INTEREST_DAYS_COUNT_METHOD VARCHAR(16777216),
    SETTLEMENT_OPTIONS VARCHAR(16777216),
    TAXES_ON_FEES_ENABLED BOOLEAN,
    TAXES_ON_INTEREST_ENABLED BOOLEAN,
    TAXES_ON_PENALTY_ENABLED BOOLEAN,
    APPLY_INTEREST_ON_PREPAYMENT_METHOD VARCHAR(16777216),
	INTEREST_RATE_ENCODED_KEY VARCHAR(32),
	DEFAULT_INTEREST_RATE NUMBER(38,10),
	INTEREST_CHARGE_FREQUENCY VARCHAR (150),
	INTEREST_CHARGE_FREQUENCY_COUNT NUMBER(38,0),
	INTEREST_RATE_SOURCE VARCHAR(150),
	INTEREST_RATE_TERMS VARCHAR(150),
	PRODUCT_SECURITY_ENCODED_KEY VARCHAR(32),
	PRODUCT_SECURITY_IS_COLLATERAL_ENABLED BOOLEAN,
	PRODUCT_SECURITY_IS_GUARANTORS_ENABLED BOOLEAN,
	PRODUCT_SECURITY_IS_INVESTOR_FUNDS_ENABLED BOOLEAN,
	PRODUCT_SECURITY_REQUIRED_GUARANTIES NUMBER(38,0),
    constraint PK_STG_LOAN_PRODUCT
        primary key (DIMENSION_KEY)
);

-- LENDX_STG.STG_LOAN_ACCOUNTS definition

CREATE TABLE LENDX_STG.STG_LOAN_ACCOUNTS
(
	FACT_KEY VARCHAR(32) NOT NULL,
    DIM_ORIGINATOR VARCHAR(32) NOT NULL,
    DIM_LOAN_PRODUCT VARCHAR(32) NOT NULL,
    DIM_BORROWER VARCHAR(32) NOT NULL,
    ENCODED_KEY VARCHAR(32) NOT NULL,
	DIM_TIME_APPROVED NUMBER(10,0) NOT NULL,
    ACCOUNT_ARREARS_DATE_CALCULATION_METHOD VARCHAR(100),
    ACCOUNT_ARREARS_ENCODED_KEY VARCHAR(32),
    ACCOUNT_ARREARS_NON_WORKING_DAYS_METHOD VARCHAR(100),
    ACCOUNT_ARREARS_TOLERANCE_CALCULATION_METHOD VARCHAR(100),
    ACCOUNT_ARREARS_TOLERANCE_PERIOD NUMBER(38, 0),
    ACCOUNT_HOLDER_KEY VARCHAR(16777216),
    ACCOUNT_HOLDER_TYPE VARCHAR(16777216),
    ACCOUNT_STATE VARCHAR(16777216),
    ACCOUNT_SUB_STATE VARCHAR(16777216),
    ACCRUED_INTEREST NUMBER(38, 6),
    ACCRUED_PENALTY NUMBER(38, 6),
    ACTIVATION_TRANSACTION_KEY VARCHAR(16777216),
    ALLOW_OFFSET BOOLEAN,
    APPROVED_DATE TIMESTAMP_TZ(9),
    ARREARS_TOLERANCE_PERIOD NUMBER(38, 0),
    ASSETS VARIANT,
    ASSIGNED_BRANCH_KEY VARCHAR(16777216),
    FEES_BALANCE NUMBER(38, 10),
    FEES_DUE NUMBER(38, 0),
    FEES_PAID NUMBER(38, 10),
    INTEREST_BALANCE NUMBER(38, 10),
    INTEREST_DUE NUMBER(38, 10),
    INTEREST_FROM_ARREARS_BALANCE NUMBER(38, 10),
    INTEREST_FROM_ARREARS_DUE NUMBER(38, 10),
    INTEREST_FROM_ARREARS_PAID NUMBER(38, 10),
    INTEREST_PAID NUMBER(38, 10),
    PENALTY_BALANCE NUMBER(38, 10),
    PENALTY_DUE NUMBER(38, 10),
    PENALTY_PAID NUMBER(38, 10),
    PRINCIPAL_BALANCE NUMBER(38, 10),
    PRINCIPAL_DUE NUMBER(38, 10),
    PRINCIPAL_PAID NUMBER(38, 10),
    REDRAW_BALANCE NUMBER(38, 10),
    CLOSED_DATE TIMESTAMP_TZ(9),
    CREATION_DATE TIMESTAMP_TZ(9),
    CUSTOM_FIELDS VARIANT,
    DISBURSEMENT_DATE TIMESTAMP_TZ(9),
    EXPECTED_DISBURSEMENT_DATE TIMESTAMP_TZ(9),
    FIRST_REPAYMENT_DATE TIMESTAMP_TZ(9),
    FUNDING_SOURCES VARIANT,
    FUTURE_PAYMENTS_ACCEPTANCE VARCHAR(16777216),
    GUARANTORS VARIANT,
    ID VARCHAR(16777216) NOT NULL,
    INTEREST_FROM_ARREARS_ACCRUED NUMBER(38, 6),
    ACCRUE_INTEREST_AFTER_MATURITY BOOLEAN,
    INTEREST_APPLICATION_METHOD VARCHAR(100),
    INTEREST_BALANCE_CALCULATION_METHOD VARCHAR(100),
    INTEREST_CALCULATION_METHOD VARCHAR(50),
    INTEREST_CHARGE_FREQUENCY VARCHAR(50),
    INTEREST_RATE NUMBER(38, 10),
    INTEREST_RATE_SOURCE VARCHAR(50),
    INTEREST_TYPE VARCHAR(50),
    LAST_ACCOUNT_APPRAISAL_DATE TIMESTAMP_TZ(9),
    LAST_INTEREST_APPLIED_DATE TIMESTAMP_TZ(9),
    LAST_MODIFIED_DATE TIMESTAMP_TZ(9),
    LAST_SET_TO_ARREARS_DATE TIMESTAMP_TZ(9),
    LATE_PAYMENTS_RECALCULATION_METHOD VARCHAR(16777216),
    LOAN_AMOUNT NUMBER(38, 6),
    LOAN_NAME VARCHAR(16777216),
    ORIGINAL_ACCOUNT_KEY VARCHAR(16777216),
    PAYMENT_METHOD VARCHAR(16777216),
    LOAN_PENALTY_CALCULATION_METHOD VARCHAR(50),
    PENALTY_RATE NUMBER(10, 4),
    APPLY_INTEREST_ON_PREPAYMENT_METHOD VARCHAR(50),
    PREPAYMENT_RECALCULATION_METHOD VARCHAR(50),
    PRODUCT_TYPE_KEY VARCHAR(16777216),
    RESCHEDULED_ACCOUNT_KEY VARCHAR(16777216),
    GRACE_PERIOD NUMBER(10, 0),
    GRACE_PERIOD_TYPE VARCHAR(50),
    HAS_CUSTOM_SCHEDULE BOOLEAN,
    PAYMENT_PLAN VARIANT,
    PERIODIC_PAYMENT NUMBER(10, 0),
    PRINCIPAL_REPAYMENT_INTERVAL NUMBER(10, 0),
    REPAYMENT_INSTALLMENTS NUMBER(10, 0),
    REPAYMENT_PERIOD_COUNT NUMBER(10, 0),
    REPAYMENT_PERIOD_UNIT VARCHAR(50),
    REPAYMENT_SCHEDULE_METHOD VARCHAR(50),
    SCHEDULE_DUE_DATES_METHOD VARCHAR(50),
    TRANCHES VARIANT,
    LAST_INTEREST_REVIEW_DATE TIMESTAMP_TZ(9),
    CURRENCY_CODE VARCHAR(10),
	NOTES VARCHAR(16777216),
    CONSTRAINT PK_STG_LOAN_ACCOUNTS
        PRIMARY KEY (
        FACT_KEY
    )
);

-- LENDX_STG.STG_LOAN_REPAYMENTS definition

CREATE OR REPLACE TABLE LENDX_STG.STG_LOAN_REPAYMENTS (
	FACT_KEY VARCHAR(32) NOT NULL,
	FACT_LOAN_ACCOUNTS_FK VARCHAR(32) NOT NULL,
	DUE_DATE TIMESTAMP_TZ(9),
	ENCODED_KEY VARCHAR(32) NOT NULL,
	FEES_DUE NUMBER(38,6),
	FEES_PAID NUMBER(38,6),
	INTEREST_DUE NUMBER(38,6),
	INTEREST_PAID NUMBER(38,6),
	PARENT_ACCOUNT_KEY VARCHAR(32),
	PENALTY_DUE NUMBER(38,6),
	PENALTY_PAID NUMBER(38,6),
	PRINCIPAL_DUE NUMBER(38,6),
	PRINCIPAL_PAID NUMBER(38,6),
	STATE VARCHAR(100),
	TAX_FEES_DUE NUMBER(38,6),
	TAX_FEES_PAID NUMBER(38,6),
	TAX_INTEREST_DUE NUMBER(38,6),
	TAX_INTEREST_PAID NUMBER(38,6),
	TAX_PENALTY_DUE NUMBER(38,6),
	TAX_PENALTY_PAID NUMBER(38,6),
	CONSTRAINT PK_STG_LOAN_REPAYMENTS
        PRIMARY KEY (
        FACT_KEY
    )
);


-- LENDX_STG.STG_INSTALLMENTS definition

CREATE OR REPLACE TABLE LENDX_STG.STG_INSTALLMENTS (
	ENCODED_KEY VARCHAR(32) NOT NULL,
	INSTALLMENT_INTEREST_AMOUNT_DUE NUMBER(38,6),
	INSTALLMENT_INTEREST_AMOUNT_EXPECTED NUMBER(38,6),
	INSTALLMENT_INTEREST_AMOUNT_PAID NUMBER(38,6),
	INSTALLMENT_INTEREST_TAX_DUE NUMBER(38,6),
	INSTALLMENT_INTEREST_TAX_EXPECTED NUMBER(38,6),
	INSTALLMENT_INTEREST_TAX_PAID NUMBER(38,6),
	INSTALLMENT_LAST_PAID_DATE TIMESTAMP_TZ(9),
	INSTALLMENT_NUMBER NUMBER(10),
	INSTALLMENT_PENALTY_AMOUNT_DUE NUMBER(38,6),
	INSTALLMENT_PENALTY_AMOUNT_EXPECTED NUMBER(38,6),
	INSTALLMENT_PENALTY_AMOUNT_PAID NUMBER(38,6),
	INSTALLMENT_PENALTY_TAX_DUE NUMBER(38,6),
	INSTALLMENT_PENALTY_TAX_EXPECTED NUMBER(38,6),
	INSTALLMENT_PENALTY_TAX_PAID NUMBER(38,6),
	INSTALLMENT_REPAID_DATE TIMESTAMP_TZ(9),
	INSTALLMENT_STATE VARCHAR(100),
	CONSTRAINT PK_STG_LOAN_REPAYMENTS
        PRIMARY KEY (
        ENCODED_KEY
    )
);